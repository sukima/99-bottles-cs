<!DOCTYPE html>  <html> <head>   <title>99bottles.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="99bottles.html">                 99bottles.coffee               </a>                                           <a class="source" href="collapsible.html">                 collapsible.coffee               </a>                                           <a class="source" href="runner.html">                 runner.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               99bottles.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <h2>99 Bottles of Beer</h2>

<p>Sung by <a href="http://coffeescript.org">CoffeeScript</a> <br />
Writen by <a href="http://tritarget.org">Devin Weaver</a></p>

<p>This is an example application to show off some of the neat parts of the
CoffeeScript language. It was intended as a submission to their
<a href="http://99-bottles-of-beer.net/">99 bottles of beer</a> programming language database.</p>

<p>This file is the basic file you would use to run in your own webpage. The
supporting files such as the original <a href="http://sukima.github.com/99-bottles-cs/">source</a>, <a href="http://sukima.github.com/99-bottles-cs/">demo</a> or to run the
<a href="http://sukima.github.com/99-bottles-cs/">unit tests</a> You can visit the project <a href="http://sukima.github.com/99-bottles-cs/">homepage</a></p>

<h3>How it works</h3>

<p>Depending on your environment and prefered execution method you instantiate a
new Song and a new DisplayAdapter. Then you run the <code>sing()</code> method of the
Song.</p>

<p>Depending on how you wish to display the output pick a DisplayAdapter. This
file currently supports the following Display Adapters:</p>

<ul>
<li><code>ConsoleDisplay</code> - Will print the verses to the JavaScript console (default)</li>
<li><code>AlertDisplay</code> - Will pop-up an alert for each verse</li>
<li><code>DomDisplay</code> - Will manipulate a div to print out the song into it's contents</li>
<li><code>JqDisplay</code> - Uses jQuery to do the same thing as the DomDisplay</li>
</ul>

<p>The two choices for execution method are:</p>

<ul>
<li><code>SyncSong</code> - Uses a for loop to iterate over the verses in the song (blocking)</li>
<li><code>AsyncSong</code> - Uses setTimeout to iterate over the song (non-blocking)</li>
</ul>

<h4>Example</h4>

<pre><code>display = new ConsoleDisplay()
song = new SyncSong(99)
song.setDisplay display
song.sing()
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h3>Capitalize a string</h3>

<p>A utility method to quickly capitalize the first letter in a string.
This is added onto the <code>String</code> object as a utility.</p>

<p>The <code>::</code> operator is a CS form of the JavaScript prototype:</p>

<pre><code>String.prototype.cap = function() {...}
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nb">String</span><span class="o">::</span><span class="nv">cap = </span><span class="o">-&gt;</span>
  <span class="nx">@charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">toUpperCase</span><span class="p">()</span> <span class="o">+</span> <span class="nx">@slice</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <h3>Our main namespace</h3>

<p>A namespace for all our code. This allows us to export just one object instead
of several. It also houses variables for state, defaults, and strings.</p>

<h4>State machine</h4>

<p>A simple variable to allow us to interactively turn off any running timed
events.</p>

<h4>Defaults</h4>

<p>Provides a easy accessible spot to change configuration options.</p>

<h4>Strings</h4>

<p>Used to easily change the strings used in the song. Perhaps different wording
or localizing to another language. This is a simplistic way of doing that.</p>

<p>This also shows the use of CS
<a href="http://rosettacode.org/wiki/Here_document#CoffeeScript">heredoc</a>.</p>

<h4>Application Error objects</h4>

<p>Easily create throw-able and query-able errors.</p>

<p>Instead of making new classes for errors or just sending a simple string
(which would make querying more difficult and would <em>not</em> DRY the code) we can
use an object which has the name and message properties already defined.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">App =</span>
  <span class="nv">asyncRunning: </span><span class="kc">on</span>
  <span class="nv">defaults:</span>
    <span class="nv">bottle_count: </span><span class="mi">99</span>
    <span class="nv">loop_delay: </span><span class="mi">500</span>
  <span class="nv">strings:</span>
    <span class="nv">bottle: </span><span class="s2">&quot;bottle of beer&quot;</span>
    <span class="nv">bottles: </span><span class="s2">&quot;bottles of beer&quot;</span>
    <span class="nv">on_the_wall: </span><span class="s2">&quot;on the wall&quot;</span>
    <span class="nv">take_one_down: </span><span class="s2">&quot;take one down and pass it around&quot;</span>
    <span class="nv">buy_some_more: </span><span class="s2">&quot;go to the store and buy some more&quot;</span>
    <span class="nv">no_more: </span><span class="s2">&quot;no more&quot;</span>
    <span class="nv">large_loop_warn: </span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">      Calculating this many bottles in a loop can slow down your</span>
<span class="s2">      browser or freeze it. Are you sure you wish to continue?</span>
<span class="s2">      &quot;&quot;&quot;</span>
  <span class="nv">errors:</span>
    <span class="nv">BottleCountTooSmall:</span>
      <span class="nv">name: </span><span class="s2">&quot;BottleCountError&quot;</span>
      <span class="nv">message: </span><span class="s2">&quot;bottle count cannot be less then 1&quot;</span>
    <span class="nv">BottleCountTooLarge:</span>
      <span class="nv">name: </span><span class="s2">&quot;BottleCountError&quot;</span>
      <span class="nv">message: </span><span class="s2">&quot;bottle count too large for display method&quot;</span>
    <span class="nv">MissingArgument:</span>
      <span class="nv">name: </span><span class="s2">&quot;ArgumentError&quot;</span>
      <span class="nv">message: </span><span class="s2">&quot;missing argument&quot;</span>
    <span class="nv">MissingLibrary:</span>
      <span class="nv">name: </span><span class="s2">&quot;MissingLibrary&quot;</span>
      <span class="nv">message: </span><span class="s2">&quot;missing jQuery library&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <h3>Class Song</h3>

<p>This is the main logic for singing a song. Because there is more then one way
to make the looping (synchronous vs asynchronous) this class acts as an
adapter which other <em>song methods</em> will extend to implement the <em>song</em>
functionality.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">App</span><span class="p">.</span><span class="nx">Song</span>
  <span class="nv">constructor: </span><span class="nf">(@initial_bottle_count = App.defaults.bottle_count) -&gt;</span>
    <span class="k">throw</span> <span class="nx">App</span><span class="p">.</span><span class="nx">errors</span><span class="p">.</span><span class="nx">BottleCountTooSmall</span> <span class="nx">unless</span> <span class="nx">@initial_bottle_count</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="vi">@bottle_count = </span><span class="nx">@initial_bottle_count</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p><code>gitDisplay()</code> will either return the save display adapter or make a
default one the first time this method is called.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">getDisplay: </span><span class="o">-&gt;</span>
    <span class="nx">@display</span> <span class="o">?=</span> <span class="k">new</span> <span class="nx">App</span><span class="p">.</span><span class="nx">ConsoleDisplay</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Allow us to set the display adapter pragmatically.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">setDisplay: </span><span class="nf">(@display) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Get and construct the string for how many bottles we have.</p>

<p>It can handle arguments but we default them to what would normally be used
to add some flexibility. Using the = operator in the argument list CS
automatically takes care of assignment for us and we don't have to type in
any initialization at the beginning of the function.</p>

<p>the variable <code>s</code> is used to prevent from having to type <code>App.strings</code> over
and over.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">bottles: </span><span class="nf">(count = @bottle_count, s = App.strings) -&gt;</span>
    <span class="nv">num = </span><span class="k">if</span> <span class="nx">count</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">then</span> <span class="s2">&quot;#{count}&quot;</span> <span class="k">else</span> <span class="nx">s</span><span class="p">.</span><span class="nx">no_more</span>
    <span class="k">if</span> <span class="nx">count</span> <span class="o">is</span> <span class="mi">1</span>
      <span class="s2">&quot;#{num} #{s.bottle}&quot;</span>
    <span class="k">else</span>
      <span class="s2">&quot;#{num} #{s.bottles}&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Construct a full verse taking into account how many bottles are left. Then
use the assigned display adapter to output the new verse.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">printVerse: </span><span class="nf">(bottle_count = @bottle_count, s = App.strings) -&gt;</span>
    <span class="nx">@getDisplay</span><span class="p">().</span><span class="nx">print</span> <span class="s2">&quot;#{@bottles(bottle_count).cap()} #{s.on_the_wall}, #{@bottles(bottle_count)}.&quot;</span>
    <span class="k">if</span> <span class="nx">bottle_count</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="nx">@getDisplay</span><span class="p">().</span><span class="nx">print</span> <span class="s2">&quot;#{s.take_one_down.cap()}, #{@bottles(bottle_count - 1)} #{s.on_the_wall}.&quot;</span>
    <span class="k">else</span>
      <span class="nx">@getDisplay</span><span class="p">().</span><span class="nx">print</span> <span class="s2">&quot;#{s.buy_some_more.cap()}, #{@bottles(@initial_bottle_count)} #{s.on_the_wall}.&quot;</span>
    <span class="nx">@getDisplay</span><span class="p">().</span><span class="nx">flush</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>This is the main method for the singing loop. Because we wanted to offer
examples of different loop methods we will inherit from the Song class and
override the sing method.</p>

<p>Some display adapters will really bork the browser if they are to display
100 verses (like the default 99 bottles song goes) Most notably the display
method which uses alert boxes would end up displaying 100 pop ups. So we add
a check to prevent executing with that many bottles.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">sing: </span><span class="o">-&gt;</span>
    <span class="k">throw</span> <span class="nx">App</span><span class="p">.</span><span class="nx">errors</span><span class="p">.</span><span class="nx">BottleCountTooLarge</span> <span class="k">if</span> <span class="nx">@getDisplay</span><span class="p">().</span><span class="nx">isBottleCountUnsafe</span><span class="p">(</span><span class="nx">@bottle_count</span><span class="p">)</span>
    <span class="nx">@getDisplay</span><span class="p">().</span><span class="nx">clear</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <h3>Synchronized Song</h3>

<p>This version of the loop is <em>synchronous</em> meaning it will block the
environment until the loop finishes.</p>

<p>Because of this blocking if our loop is too long it can freeze the browser.
The constructor will ask the user if they are sure they want to continue if the
requested number of verses reach 1200 bottles. (limit chosen at a whim)</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">App</span><span class="p">.</span><span class="nx">SyncSong</span> <span class="k">extends</span> <span class="nx">App</span><span class="p">.</span><span class="nx">Song</span>
  <span class="nv">constructor: </span><span class="nf">(bottles) -&gt;</span>
    <span class="k">if</span> <span class="nx">bottles</span> <span class="o">&gt;=</span> <span class="mi">1200</span>
      <span class="k">throw</span> <span class="nx">App</span><span class="p">.</span><span class="nx">errors</span><span class="p">.</span><span class="nx">BottleCountTooLarge</span> <span class="nx">unless</span> <span class="nx">confirm</span> <span class="nx">App</span><span class="p">.</span><span class="nx">strings</span><span class="p">.</span><span class="nx">large_loop_warn</span>
    <span class="k">super</span> <span class="nx">bottles</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>We override the sing method to run our loop. Calling super allows us to use
the safety checks from the parent Song object above.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">sing: </span><span class="o">-&gt;</span>
    <span class="k">super</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>CoffeeScript abstracts for loops. This statement will not change
<code>@bottle_count</code>. In most cases this is preferred but in this one use case
it looks redundant to also decrement the variable on our own.</p>

<pre><code>for i in [@bottle_count..0]
  @printVerse()
  @bottle_count--
</code></pre>

<p>A better approach is to avoid a state/instance variable and instead
pass the counter to the function in question. The downside is that
<code>@bottle_count</code> will not hold an accurate value of the current state.
However, since this is in a synchronous method there is never going to be
need to access the state outside of the running loop. Only in
Asynchronous methods would the <code>@bottle_count</code> need to be accurate.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@printVerse</span><span class="p">(</span><span class="nx">count</span><span class="p">)</span> <span class="k">for</span> <span class="nx">count</span> <span class="k">in</span> <span class="p">[</span><span class="nx">@bottle_count</span><span class="p">..</span><span class="mi">0</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>The use of return at the end stops CS from creating a results array like
it usually does with the for loop. It's done purely so the JavaScript
created is slightly more efficient since we will not use the results.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <h3>Asynchronous Song</h3>

<p>This execution method uses JavaScript's <code>setTimeout</code> function to return the
thread control back to the browser intermittently. This form of non-blocking
allows the user to feel like he/she still can interact with the web page even
though there is work being done in the background. Granted the work is
blocking as it executes but because we only calculate on interval of the loop
at a time in between the steps the browser lets the user interact. This form
of asynconous code isn't trully threaded but will provide enough that it seems
threaded. It also has the added advantage of allowing the verses to be printed
out in a more delay manor as if the song was really being sung.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">App</span><span class="p">.</span><span class="nx">AsyncSong</span> <span class="k">extends</span> <span class="nx">App</span><span class="p">.</span><span class="nx">Song</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>This constructor like the ones above also takes an optional <em>callback</em>
function which will allow things to happen after the song is finished.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">constructor: </span><span class="nf">(bottles, @callback) -&gt;</span>
    <span class="k">super</span> <span class="nx">bottles</span>
    <span class="nv">App.asyncRunning = </span><span class="kc">on</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Handle the sing method and pass it on to the async recursive function.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">sing: </span><span class="o">-&gt;</span>
    <span class="k">super</span>
    <span class="nx">@singVerse</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>This methos calls itself through the use of <code>setTimeout</code>.</p>

<p>Each time it executes it checks the <code>App.asyncRunning</code> boolean to see if it
should abandon (finish) this loop or continue. When complete it will execute
the callback if it exists</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">singVerse: </span><span class="o">=&gt;</span>
    <span class="k">if</span> <span class="nx">App</span><span class="p">.</span><span class="nx">asyncRunning</span> <span class="o">and</span> <span class="nx">@bottle_count</span> <span class="o">&gt;=</span> <span class="mi">0</span>
      <span class="nx">@printVerse</span><span class="p">()</span>
      <span class="nx">@bottle_count</span><span class="o">--</span>
      <span class="nx">setTimeout</span> <span class="nx">@singVerse</span><span class="p">,</span> <span class="nx">App</span><span class="p">.</span><span class="nx">defaults</span><span class="p">.</span><span class="nx">loop_delay</span>
    <span class="k">else</span>
      <span class="nx">@callback</span><span class="o">?</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <h2>Display Adapters</h2>

<p>Used to display the results. Uses an adapter model to allow multiple ways to
display the output.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">App</span><span class="p">.</span><span class="nx">DisplayAdapter</span>
  <span class="nv">constructor: </span><span class="o">-&gt;</span>
    <span class="nx">@resetLines</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>this is only used for some adapters so we will default to "no"</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">isBottleCountUnsafe: </span><span class="nf">(bottle_count) -&gt;</span> <span class="kc">no</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>clear() is responsable for clearing the output buffer (not applicable for
all adapters)</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">clear: </span><span class="o">-&gt;</span>
    <span class="nx">@resetLines</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>print() will add a line of text to the output buffer</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">print: </span><span class="nf">(text) -&gt;</span>
    <span class="nx">@lines</span><span class="p">.</span><span class="nx">push</span> <span class="nx">text</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>flush() is responsible for displaying the output buffer. Functionally used to
display a full verse.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">flush: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>resetLines() will clear out the internal output buffer. <strong>this should be
called in every implementation of flush()</strong></p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">resetLines: </span><span class="o">-&gt;</span>
    <span class="vi">@lines = </span><span class="p">[]</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>getAdapter() is a static method which will create a new adapter based on a
string keyword. This is an entirely optional method designed to make web site
integration easier allowing the value of a input field drive the choice of
what display adapter to use. It also illustrates the use of the CS switch
statement.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@getAdapter: </span><span class="nf">(display_id, selector) -&gt;</span>
    <span class="k">switch</span> <span class="nx">display_id</span>
      <span class="k">when</span> <span class="s2">&quot;jq&quot;</span> <span class="k">then</span> <span class="k">new</span> <span class="nx">App</span><span class="p">.</span><span class="nx">JqDisplay</span><span class="p">(</span><span class="nx">selector</span><span class="p">)</span>
      <span class="k">when</span> <span class="s2">&quot;alert&quot;</span> <span class="k">then</span> <span class="k">new</span> <span class="nx">App</span><span class="p">.</span><span class="nx">AlertDisplay</span>
      <span class="k">when</span> <span class="s2">&quot;dom&quot;</span> <span class="k">then</span> <span class="k">new</span> <span class="nx">App</span><span class="p">.</span><span class="nx">DomDisplay</span><span class="p">(</span><span class="nx">selector</span><span class="p">)</span>
      <span class="k">else</span> <span class="k">new</span> <span class="nx">App</span><span class="p">.</span><span class="nx">ConsoleDisplay</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <h3>Console Display Adapter (default)</h3>

<p>A simple display adapter that writes all output to the JavaScript console.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">App</span><span class="p">.</span><span class="nx">ConsoleDisplay</span> <span class="k">extends</span> <span class="nx">App</span><span class="p">.</span><span class="nx">DisplayAdapter</span>
  <span class="nv">print: </span><span class="nf">(text) -&gt;</span>
    <span class="nx">console</span><span class="o">?</span><span class="p">.</span><span class="nx">log</span> <span class="nx">text</span>
  <span class="nv">flush: </span><span class="o">-&gt;</span>
    <span class="nx">console</span><span class="o">?</span><span class="p">.</span><span class="nx">log</span> <span class="s2">&quot;-----&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <h3>Alert display adapter</h3>

<p>Another simple display adapter which prints out each verse in a pop-up alert.</p>

<p>Because this can be a nightmare if the number of verses are large we will
prevent this method from working if the bottle count is more then 5 verses.
(5 seemed a reasonable number of pop-ups to go through).</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">App</span><span class="p">.</span><span class="nx">AlertDisplay</span> <span class="k">extends</span> <span class="nx">App</span><span class="p">.</span><span class="nx">DisplayAdapter</span>
  <span class="nv">isBottleCountUnsafe: </span><span class="nf">(bottle_count) -&gt;</span> <span class="p">(</span><span class="nx">bottle_count</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">)</span>
  <span class="nv">flush: </span><span class="o">-&gt;</span>
    <span class="nv">text = </span><span class="s2">&quot;&quot;</span>
    <span class="nx">text</span> <span class="o">+=</span> <span class="s2">&quot;#{line}\n&quot;</span> <span class="k">for</span> <span class="nx">line</span> <span class="k">in</span> <span class="nx">@lines</span>
    <span class="nx">@resetLines</span><span class="p">()</span>
    <span class="nx">alert</span> <span class="nx">text</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <h3>Non-jQuery dom display adapter</h3>

<p>This is an example on how to use a display adapter to manipulate a DIV and
print the verses to it using the standard JavaScript DOM functions.</p>

<p>We need a selector to work with so fail if one is missing.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">App</span><span class="p">.</span><span class="nx">DomDisplay</span> <span class="k">extends</span> <span class="nx">App</span><span class="p">.</span><span class="nx">DisplayAdapter</span>
  <span class="nv">constructor: </span><span class="nf">(@selector) -&gt;</span>
    <span class="k">throw</span> <span class="nx">App</span><span class="p">.</span><span class="nx">errors</span><span class="p">.</span><span class="nx">MissingArgument</span> <span class="nx">unless</span> <span class="nx">@selector</span><span class="o">?</span>
    <span class="k">super</span>
    <span class="vi">@el = </span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="nx">@selector</span><span class="p">)</span>
  <span class="nv">clear: </span><span class="o">-&gt;</span>
    <span class="k">super</span>
    <span class="vi">@el.innerHTML = </span><span class="s2">&quot;&quot;</span>
  <span class="nv">flush: </span><span class="o">-&gt;</span>
    <span class="nv">html = </span><span class="s2">&quot;&quot;</span>
    <span class="nx">html</span> <span class="o">+=</span> <span class="s2">&quot;#{line} &lt;br /&gt;&quot;</span> <span class="k">for</span> <span class="nx">line</span> <span class="k">in</span> <span class="nx">@lines</span>
    <span class="nv">p = </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span> <span class="s2">&quot;p&quot;</span>
    <span class="nv">p.innerHTML = </span><span class="nx">html</span>
    <span class="nx">@el</span><span class="p">.</span><span class="nx">appendChild</span> <span class="nx">p</span>
    <span class="nx">@resetLines</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <h3>jQuery display adapter</h3>

<p>This does the same thing as the DomDisplay but uses jQuery syntax to
manipulate the DOM. It also checks for a selector argument. If we attempt to
use this class on a page that did not load jQuery it will have problems so we
check to make sure jQuery is defined. Otherwise fail with an error.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">App</span><span class="p">.</span><span class="nx">JqDisplay</span> <span class="k">extends</span> <span class="nx">App</span><span class="p">.</span><span class="nx">DisplayAdapter</span>
  <span class="nv">constructor: </span><span class="nf">(@selector) -&gt;</span>
    <span class="k">throw</span> <span class="nx">App</span><span class="p">.</span><span class="nx">errors</span><span class="p">.</span><span class="nx">MissingArgument</span> <span class="nx">unless</span> <span class="nx">@selector</span><span class="o">?</span>
    <span class="k">throw</span> <span class="nx">App</span><span class="p">.</span><span class="nx">errors</span><span class="p">.</span><span class="nx">MissingLibrary</span> <span class="nx">unless</span> <span class="nx">jQuery</span><span class="o">?</span>
    <span class="k">super</span>
    <span class="vi">@el = </span><span class="nx">jQuery</span><span class="p">(</span><span class="nx">@selector</span><span class="p">)</span>
  <span class="nv">clear: </span><span class="o">-&gt;</span>
    <span class="k">super</span>
    <span class="nx">@el</span><span class="p">.</span><span class="nx">empty</span><span class="p">()</span>
  <span class="nv">flush: </span><span class="o">-&gt;</span>
    <span class="nv">html = </span><span class="s2">&quot;&lt;p&gt;&quot;</span>
    <span class="nx">html</span> <span class="o">+=</span> <span class="s2">&quot;#{line}&lt;br /&gt;&quot;</span> <span class="k">for</span> <span class="nx">line</span> <span class="k">in</span> <span class="nx">@lines</span>
    <span class="nx">html</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/p&gt;&quot;</span>
    <span class="nx">@el</span><span class="p">.</span><span class="nx">append</span> <span class="nx">html</span>
    <span class="nx">@resetLines</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>If this file is used <em>without</em> using CommonJS (as you would if building from a
node.js environment using <a href="http://spinejs.com/docs/hem">hem</a>) then the module line won't work. We instead
allow it to export to the window object. We also will export it for when we do
run it in a CommonJS environment.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nb">window</span><span class="p">.</span><span class="nv">App = </span><span class="nx">App</span>
<span class="nx">module</span><span class="o">?</span><span class="p">.</span><span class="nv">exports = </span><span class="nx">App</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 